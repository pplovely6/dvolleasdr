<!DOCTYPE html>
<html lang="fr">

<head>
    <% const pageTitle=(player.name || 'Joueur' ) + ' - N°' + player.number + ' | AS Dardilly Volley' ; const
        pageDesc=`Découvrez les statistiques et le profil de ${player.name}, joueur de volleyball à l'AS Dardilly.
        Poste: ${player.position || player.pos || 'N/A' }.`; const profileImg='/' + heroImage; %>
        <%- include('partials/head', { title: pageTitle, description: pageDesc, ogImage: profileImg }) %>

            <!-- JSON-LD for AI & Search Engines -->
            <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "<%= player.name %>",
      "jobTitle": "<%= player.position || player.pos %>",
      "memberOf": {
        "@type": "SportsOrganization",
        "name": "AS Dardilly Volleyball"
      },
      "image": "<%= profileImg %>",
      "description": "<%= pageDesc %>",
      "knowsAbout": ["Volleyball", "Sport", "AS Dardilly"],
      "nationality": "<%= player.nationality || 'France' %>"
    }
    </script>
</head>

<body>
    <%- include('partials/header') %>

        <main itemscope itemtype="https://schema.org/Person">
            <section class="player-hero" data-number="<%= player.number %>">
                <div class="player-image-container">
                    <img src="/<%= heroImage %>" alt="Photo de <%= player.name %> - Joueur AS Dardilly"
                        itemprop="image">
                </div>
            </section>

            <div class="player-header">
                <div class="player-number-display" aria-label="Numéro du joueur">
                    <%= player.number %>
                </div>
                <div class="player-lastname">
                    <%= (player.name || '' ).split(' ').pop().toUpperCase() %></div>
                <h1 class="player-fullname" itemprop="name"><%= player.name %></h1>

                <div style="margin-top: 15px;">
                    <a href="/equipe/<%= teamSlug %>" style="color: #666; text-decoration: none; font-size: 0.9rem; border: 1px solid #333; padding: 5px 15px; border-radius: 20px;" data-i18n="btn_back">
                        <i class="fa-solid fa-arrow-left"></i> Retour Équipe
                    </a>
                </div>
            </div>

            <div class="vw-container">
                <div class="vw-section-title" data-i18n="sec_bio">Bio du Joueur</div>
                <div class="vw-card">
                    <div class="bio-grid">
                        <article class="bio-item">
                            <span class="bio-label" data-i18n="bio_pos">Position</span>
                            <span class="bio-value" itemprop="jobTitle"><%= player.position || player.pos || ' -' %>
                        </span>
                        </article>
                        <article class="bio-item">
                            <span class="bio-label" data-i18n="bio_nat">Nationalité</span>
                            <span class="bio-value" itemprop="nationality">
                                <%= player.nationality || '-' %>
                            </span>
                        </article>
                        <article class="bio-item">
                            <span class="bio-label" data-i18n="bio_age">Age</span>
                            <span class="bio-value">
                                <%= player.age || '-' %>
                            </span>
                        </article>
                        <article class="bio-item">
                            <span class="bio-label" data-i18n="bio_dob">Date Naissance</span>
                            <span class="bio-value">
                                <%= player.dob || '-' %>
                            </span>
                        </article>
                        <article class="bio-item">
                            <span class="bio-label" data-i18n="bio_hgt">Taille</span>
                            <span class="bio-value">
                                <%= player.height || '-' %>
                            </span>
                        </article>
                </div>
            </div>

            <% const s=player.stats || { totalPoints: "-" , avgPerMatch: "-" , attack: { points: "-" , eff: "-" ,
                avg: "-" }, block: { points: "-" , succ: "-" , avg: "-" }, serve: { points: "-" , succ: "-" , avg: "-" }
                }; %>

                <div class="vw-section-title" style="margin-top: 50px;" data-i18n="sec_stats">Statistiques de
                    Compétition</div>
                <div class="vw-card">
                    <div class="stats-grid">
                        <div class="stat-group total-points-box">
                            <span class="bio-label" data-i18n="st_total">Total Points</span>
                            <div class="total-score">
                                <%= s.totalPoints %>
                            </div>
                            <div class="avg-match">
                                <span class="avg-label" data-i18n="st_avg">Moyenne par Match</span>
                                <span class="avg-value">
                                    <%= s.avgPerMatch %>
                                </span>
                            </div>
                        </div>

                        <div class="stat-group">
                            <div class="stat-header"><i class="fa-solid fa-bolt stat-icon"></i><span class="stat-title"
                                    data-i18n="st_atk">Points Attaque</span></div>
                            <div class="stat-main-value">
                                <%= s.attack.points %>
                            </div>
                            <div class="sub-stats">
                                <div class="sub-stat-item"><span class="sub-label"
                                        data-i18n="st_eff">Efficacité</span><span class="sub-val">
                                        <%= s.attack.eff %>
                                    </span></div>
                                <div class="sub-stat-item"><span class="sub-label" data-i18n="st_avg_pt">Pts
                                        Moyens</span><span class="sub-val">
                                        <%= s.attack.avg %>
                                    </span></div>
                            </div>
                        </div>

                        <div class="stat-group">
                            <div class="stat-header"><i class="fa-solid fa-hand stat-icon"></i><span class="stat-title"
                                    data-i18n="st_blk">Points Block</span></div>
                            <div class="stat-main-value">
                                <%= s.block.points %>
                            </div>
                            <div class="sub-stats">
                                <div class="sub-stat-item"><span class="sub-label"
                                        data-i18n="st_succ">Succès</span><span class="sub-val">
                                        <%= s.block.succ || s.block.success || '-' %>
                                    </span></div>
                                <div class="sub-stat-item"><span class="sub-label" data-i18n="st_avg_pt">Pts
                                        Moyens</span><span class="sub-val">
                                        <%= s.block.avg %>
                                    </span></div>
                            </div>
                        </div>

                        <div class="stat-group">
                            <div class="stat-header"><i class="fa-solid fa-bullseye stat-icon"></i><span
                                    class="stat-title" data-i18n="st_srv">Points Service</span></div>
                            <div class="stat-main-value">
                                <%= s.serve ? s.serve.points : '-' %>
                            </div>
                            <div class="sub-stats">
                                <div class="sub-stat-item"><span class="sub-label"
                                        data-i18n="st_succ">Succès</span><span class="sub-val">
                                        <%= s.serve ? (s.serve.succ || s.serve.success || '-' ) : '-' %>
                                    </span></div>
                                <div class="sub-stat-item"><span class="sub-label" data-i18n="st_avg_pt">Pts
                                        Moyens</span><span class="sub-val">
                                        <%= s.serve ? s.serve.avg : '-' %>
                                    </span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="vw-section-title" style="margin-top: 50px;" data-i18n="sec_matches">Last Matches Played
                </div>
                <div class="match-history-grid" style="display: grid; gap: 20px;">
                    <% if (recentMatches && recentMatches.length> 0) { %>
                        <% recentMatches.forEach(m=> {
                            const scoreParts = (m.score || "0-0").split(/[-:]/).map(s => parseInt(s.trim()));
                            const hS = scoreParts[0] || 0;
                            const aS = scoreParts[1] || 0;
                            const isH = m.home.toUpperCase().includes("DARDILLY");
                            const isWin = isH ? (hS > aS) : (aS > hS);
                            const statusClass = isWin ? "status-win" : "status-loss";
                            %>
                            <a href="/match?id=<%= m.id %>" class="result-card <%= statusClass %>"
                                style="display: grid; grid-template-columns: 120px 1fr 100px 1fr; align-items: center; background: var(--vw-card-bg); padding: 15px; border-radius: 8px; text-decoration: none; color: white; border: 1px solid #333;">
                                <div style="text-align: center; border-right: 1px solid #333;">
                                    <div style="font-weight: 800;">
                                        <%= m.date %>
                                    </div>
                                </div>
                                <div style="text-align: right; padding-right: 15px; font-weight: 700;">
                                    <%= m.home %>
                                </div>
                                <div
                                    style="text-align: center; font-size: 1.5rem; font-weight: 800; color: var(--brand-yellow);">
                                    <%= m.score %>
                                </div>
                                <div style="text-align: left; padding-left: 15px; font-weight: 700;">
                                    <%= m.away %>
                                </div>
                            </a>
                            <% }) %>
                                <% } else { %>
                                    <div style="text-align:center; padding:20px; color:#666;">Aucun match récent
                                        disponible.</div>
                                    <% } %>
                </div>
                </div>
                </div>
        </main>

        <%- include('partials/footer') %>
</body>

</html>