<!DOCTYPE html>
<html lang="fr">

<head>
    <%- include('partials/head', { title: teamName + ' | AS Dardilly' }) %>
        <style>
            .results-container {
                width: 90%;
                max-width: 1400px;
                margin: 60px auto 0;
            }

            .split-results {
                display: grid;
                grid-template-columns: 1.2fr 1px 1fr;
                gap: 40px;
                align-items: stretch;
                width: 100%;
            }

            .vertical-divider {
                width: 1px;
                background: #333;
                height: 100%;
                opacity: 0.5;
            }

            .vertical-divider {
                width: 1px;
                background: #333;
                height: 100%;
                opacity: 0.5;
            }

            .match-location {
                border-top: 1px solid #333;
                padding-top: 20px;
                color: #aaa;
                font-size: 0.9rem;
                width: 100%;
                text-align: center;
                margin-top: 20px;
                z-index: 2;
            }

            .roster-row {
                display: grid;
                grid-template-columns: 60px 1fr 120px 24px;
                padding: 20px 0;
                border-bottom: 1px solid #333;
                text-decoration: none;
                color: white;
                transition: 0.2s;
                align-items: center;
            }

            .roster-row:hover {
                background: rgba(255, 255, 255, 0.05);
                padding-left: 10px;
            }

            .captain {
                background: var(--brand-yellow);
                color: black;
                font-size: 0.7rem;
                padding: 2px 5px;
                border-radius: 3px;
                font-weight: 800;
                margin-left: 10px;
            }

            @media (max-width: 1100px) {
                .split-results {
                    grid-template-columns: 1fr;
                }

                .vertical-divider {
                    display: none;
                }
            }
        </style>
</head>

<body>
    <%- include('partials/header') %>

        <% function parseDate(s) { if (!s) return 0; const parts=s.split('/'); if (parts.length===3) { let
            year=parseInt(parts[2]); if (year < 100) year +=2000; return new Date(year, parts[1] - 1,
            parts[0]).getTime(); } return new Date(s).getTime() || 0; } const sortedMatches=[...matches].sort((a, b)=>
            parseDate(b.date) - parseDate(a.date));
            const latestMatch = sortedMatches[0];

            const now = new Date(); now.setHours(0,0,0,0);
            const sortedSchedule = [...schedule].sort((a,b) => parseDate(a.date) - parseDate(b.date));
            let nextMatch = sortedSchedule.find(m => parseDate(m.date) >= now.getTime());
            if (!nextMatch && sortedSchedule.length > 0) nextMatch = sortedSchedule[0];
            %>

            <main>
                <div class="hero"
                    style="height: 40vh; background: linear-gradient(rgba(0,0,0,0.7), rgba(15,17,21,1)), url('/<%= metadata.heroImage || 'logo.jpg' %>'); display:flex; align-items:flex-end; padding-bottom:40px; padding-left:5%; background-size: cover; background-position: center;">
                    <div>
                        <h1
                            style="font-family: var(--font-head); font-size: 5rem; text-transform: uppercase; line-height: 1; margin:0;">
                            <%= (metadata.teamName ||
                                teamName).split(' ')[0] %> <span style="color:var(--brand-yellow);"><%= (metadata.teamName || teamName).split(' ').slice(1).join(' ') %></span>
                        </h1>
                        <p style="color: #bbb; letter-spacing: 2px; font-weight: 600; margin-top:10px;"><%= metadata.season || '
                                SAISON 2025 / 2026' %>
                                </p>
                    </div>
                </div>

                <section class="results-container">
                    <h2 class="section-title">Calendrier & <span>Résultats</span></h2>
                    <div class="split-results">
                        <!-- LATEST RESULT -->
                        <% let borderStyle="" ; if (latestMatch) { const sc=(latestMatch.score || "0-0"
                            ).split(/[-:]/).map(s=> parseInt(s.trim()));
                            const hS = sc[0] || 0;
                            const aS = sc[1] || 0;
                            const isH = latestMatch.home.toUpperCase().includes("DARDILLY");
                            const win = isH ? (hS > aS) : (aS > hS);
                            borderStyle = `border-left: 6px solid var(--${win ? 'win' : 'loss'});`;
                            }
                            %>
                            <div class="match-card" style="<%= borderStyle %>">
                                <div class="match-card-header">
                                    <span class="card-header-label">
                                        <%= metadata.category || 'DERNIER RÉSULTAT' %>
                                    </span>
                                    <% if (latestMatch) { %>
                                        <span class="m-date-v3">
                                            <%= latestMatch.date %>
                                        </span>
                                        <% } %>
                                </div>

                                <% if (latestMatch) { %>
                                    <div class="teams-row">
                                        <div class="team-block">
                                            <% if (latestMatch.home.toUpperCase().includes('DARDILLY')) { %>
                                                <img src="/image_fd6867.png" class="team-logo" alt="Logo">
                                                <% } else { %>
                                                    <div class="team-placeholder">
                                                        <%= latestMatch.home.substring(0,3).toUpperCase() %>
                                                    </div>
                                                    <% } %>
                                                        <div class="team-name">
                                                            <%= latestMatch.home %>
                                                        </div>
                                        </div>
                                        <div class="center-info">
                                            <div class="main-score">
                                                <%= latestMatch.score.replace('-', ' - ' ) %>
                                            </div>
                                            <div class="sets-detail">
                                                <%= Array.isArray(latestMatch.sets) ? latestMatch.sets.join(' ') : latestMatch.sets %></div>
                                    </div>
                                    <div class="team-block">
                                        <% if (latestMatch.away.toUpperCase().includes(' DARDILLY')) { %>
                                                    <img src="/image_fd6867.png" class="team-logo" alt="Logo">
                                                    <% } else { %>
                                                        <div class="team-placeholder">
                                                            <%= latestMatch.away.substring(0,3).toUpperCase() %>
                                                        </div>
                                                        <% } %>
                                                            <div class="team-name">
                                                                <%= latestMatch.away %>
                                                            </div>
                                            </div>
                                        </div>
                                        <div class="match-location">
                                            <i class="fa-solid fa-location-dot"
                                                style="color: var(--brand-yellow); margin-right: 5px;"></i>
                                            <strong>
                                                <%= latestMatch.location %>
                                            </strong>
                                        </div>
                                        <% } else { %>
                                            <div
                                                style="display:flex; height:100%; align-items:center; justify-content:center;">
                                                <p style="color:#666;">Aucun résultat disponible.</p>
                                            </div>
                                            <% } %>
                                    </div>

                                    <div class="vertical-divider"></div>

                                    <!-- NEXT MATCH -->
                                    <div class="match-card">
                                        <div class="match-card-header">
                                            <span class="card-header-label">PROCHAIN MATCH</span>
                                            <% if (nextMatch) { %>
                                                <span class="m-date-v3">
                                                    <%= nextMatch.date %>
                                                        <%= nextMatch.time ? ' • ' + nextMatch.time : '' %>
                                                </span>
                                                <% } %>
                                        </div>

                                        <% if (nextMatch) { %>
                                            <div class="teams-row">
                                                <div class="team-block">
                                                    <% if (nextMatch.home.toUpperCase().includes('DARDILLY')) { %>
                                                        <img src="/image_fd6867.png" class="team-logo" alt="Logo">
                                                        <% } else { %>
                                                            <div class="team-placeholder">
                                                                <%= nextMatch.home.substring(0,3).toUpperCase() %>
                                                            </div>
                                                            <% } %>
                                                                <div class="team-name">
                                                                    <%= nextMatch.home %>
                                                                </div>
                                                </div>
                                                <div class="center-info">
                                                    <div class="vs-text">VS</div>
                                                </div>
                                                <div class="team-block">
                                                    <% if (nextMatch.away.toUpperCase().includes('DARDILLY')) { %>
                                                        <img src="/image_fd6867.png" class="team-logo" alt="Logo">
                                                        <% } else { %>
                                                            <div class="team-placeholder">
                                                                <%= nextMatch.away.substring(0,3).toUpperCase() %>
                                                            </div>
                                                            <% } %>
                                                                <div class="team-name">
                                                                    <%= nextMatch.away %>
                                                                </div>
                                                </div>
                                            </div>
                                            <div class="match-location">
                                                <i class="fa-solid fa-location-dot"
                                                    style="color: var(--brand-yellow); margin-right: 5px;"></i>
                                                <strong>
                                                    <%= nextMatch.location %>
                                                </strong>
                                            </div>
                                            <% } else { %>
                                                <div
                                                    style="display:flex; height:100%; align-items:center; justify-content:center;">
                                                    <p style="color:#666;">Aucun match prévu.</p>
                                                </div>
                                                <% } %>
                                    </div>
                            </div>
                </section>

                <section
                    style="background: #1a1d24; border-top: 1px solid #333; padding-top: 100px; margin-top: 60px; padding-bottom: 60px;">
                    <h2 class="section-title" style="width:90%; max-width:1400px; margin:0 auto 40px;">L'Effectif
                        <span>2025-26</span>
                    </h2>
                    <div class="roster-container"
                        style="width:90%; max-width:1400px; margin:0 auto; display:grid; grid-template-columns: 1fr 1.5fr; gap:40px;">
                        <div class="roster-image"
                            style="background-position: center; background-size: cover; background-image: url('/<%= metadata.heroImage || 'logo.jpg' %>'); min-height: 500px; border-radius: 0; position: relative;">
                            <% if (metadata.rankTag) { %>
                                <div
                                    style="position: absolute; bottom: 0; left: 0; width: 100%; padding: 12px; background: var(--brand-yellow); color: black; font-weight: 800; font-size: 0.9rem; text-transform: uppercase; text-align: center; letter-spacing: 1px;">
                                    <%= metadata.rankTag %>
                                </div>
                                <% } %>
                        </div>
                        <div class="roster-content">
                            <div class="roster-header"
                                style="display:grid; grid-template-columns: 60px 1fr 120px 24px; padding: 15px 0; border-bottom: 1px solid #444; color:#888; font-weight:bold; font-size:0.85rem; text-transform:uppercase; letter-spacing:1px;">
                                <span data-i18n="roster.number">N°</span><span
                                    data-i18n="roster.player">JOUEUR</span><span
                                    data-i18n="roster.position">POSTE</span><span></span>
                            </div>
                            <% roster.sort((a,b)=> a.number - b.number).forEach(p => { %>
                                <a href="/player/<%= slug %>/<%= p.number %>" class="roster-row">
                                    <span class="num">
                                        <%= p.number %>
                                    </span>
                                    <span>
                                        <%= p.name %>
                                            <% if (p.captain) { %><span class="captain">C</span>
                                                <% } %>
                                    </span>
                                    <span class="pos">
                                        <%= p.position %>
                                    </span>
                                    <i class="fa-solid fa-chevron-right"></i>
                                </a>
                                <% }) %>
                        </div>
                    </div>
                </section>
            </main>

            <%- include('partials/footer') %>
</body>

</html>